# IP地址的基本知识

## $IP$地址

![Untitled](IP%E5%9C%B0%E5%9D%80%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86%20ef343bbbf8fd4ad58ffe496a384a16b0/Untitled.png)

由一些小的子网，通过路由器连接起来组成一个大的网络。子网可以理解为由集线器连接起来的几台计算机。

$IP$地址：

- 网络号
- 主机号

![Untitled](IP%E5%9C%B0%E5%9D%80%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86%20ef343bbbf8fd4ad58ffe496a384a16b0/Untitled%201.png)

子网掩码：

- 子网掩码为1的地方表示为网络号
- 子网掩码为0的地方表示为主机号

主机号部分的比特全部为0表示整个子网而不是子网中的某台设备，主机号部分全部为1代表向字网上所有设备发送包，即广播。

## $Socket$库提供查询$IP$地址的功能

我们的计算机上一定有$DNS$客户端，相当于$DNS$客户端的部分称为$DNS$解析器，或者简称解析器。通过$DNS$查询$IP$地址的操作叫做域名解析。

- 解析器是一段程序，包含在$Scoket$库中。
- 通过解析器向$DNS$服务器发出查询

![Untitled](IP%E5%9C%B0%E5%9D%80%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86%20ef343bbbf8fd4ad58ffe496a384a16b0/Untitled%202.png)

- 解析器的内部原理
    
    ![Untitled](IP%E5%9C%B0%E5%9D%80%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86%20ef343bbbf8fd4ad58ffe496a384a16b0/Untitled%203.png)
    
    - 解析器根据$DNS$规格生成一条数据
    - 解析器委托操作系统的内部协议栈发送数据到网卡
        - 协议栈：操作系统内部的网络控制软件，也叫“协议驱动”，“TCP/IP驱动”等。
    - 网卡将数据发送到$DNS$服务器
    - 传回$IP$
    
    $DNS$服务器发送消息时，我们当然也需要知道$DNS$服务器的$IP$地址，这个$IP$地址是通过$TCP/IP$的一个设置提前设置好的
    
    ![Untitled](IP%E5%9C%B0%E5%9D%80%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86%20ef343bbbf8fd4ad58ffe496a384a16b0/Untitled%204.png)
    

## 全世界$DNS$服务器大接力

### $DNS$服务器的基本工作

接收来自客户端的查询消息，然后根据消息的内容返回响应。

来自客户端地消息：

- 域名
- 记录类型
    
    表示域名对应何种类型的记录。例如，当类型为A时，表示域名对应的是$IP$地址。
    
    ![Untitled](IP%E5%9C%B0%E5%9D%80%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86%20ef343bbbf8fd4ad58ffe496a384a16b0/Untitled%205.png)
    

### 寻找相应的$DNS$服务器并获取$IP$地址

将负责管理下级域的服务器的$IP$地址注册到它们的上级$DNS$服务器中，然后上级域的$DNS$服务器的$IP$地址注册到更上一级服务器中，以此类推。

- 最上级是根域：书写时一般省略。
    - 根域的所有信息保存在保存在互联网中所有的服务器上。
- $com,jp$等

![Untitled](IP%E5%9C%B0%E5%9D%80%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86%20ef343bbbf8fd4ad58ffe496a384a16b0/Untitled%206.png)

![Untitled](IP%E5%9C%B0%E5%9D%80%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86%20ef343bbbf8fd4ad58ffe496a384a16b0/Untitled%207.png)

### 通过缓存加快$DNS$服务器的响应

- 现实中上级和下级服务器可能共享在同一个服务器中。
- $DNS$服务器有一个缓存功能，可以记住之前查询过的域名。
- 当域名不存在时，域名不存在也会被缓存记住。

$DNS$服务器中保存的消息都设置有一个有效期，当缓存的信息超过有效期后，数据就会从缓存中删除。