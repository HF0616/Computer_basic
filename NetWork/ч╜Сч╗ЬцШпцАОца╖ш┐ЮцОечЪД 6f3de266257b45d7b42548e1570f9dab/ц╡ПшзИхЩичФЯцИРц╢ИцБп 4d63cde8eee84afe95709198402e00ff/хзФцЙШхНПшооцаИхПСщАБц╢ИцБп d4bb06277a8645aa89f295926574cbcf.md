# 委托协议栈发送消息

知道了$IP$地址之后，就可以委托操作系统内部的协议栈向这个$IP$地址发送消息了。

## 数据收发操作

![Untitled](%E5%A7%94%E6%89%98%E5%8D%8F%E8%AE%AE%E6%A0%88%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF%20d4bb06277a8645aa89f295926574cbcf/Untitled.png)

- 客户端创建套接字
    
    ![Untitled](%E5%A7%94%E6%89%98%E5%8D%8F%E8%AE%AE%E6%A0%88%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF%20d4bb06277a8645aa89f295926574cbcf/Untitled%201.png)
    
    - 调用$Socket$库中的程序组件就可以创建套接字。
    - 创建好套接字后协议栈返回一个描述符，应用程序会将收到的描述符放在内存中。
        - 应用程序通过描述符这一类似于号码牌的东西来识别套接字。
- 将套接字连接起来形成管道。
    - 调用$Socket$库中的$connect$的程序组件来连接套接字
        - 第一个参数：描述符。
        - 第二个参数：服务器的$IP$地址。
        - 第三个参数：端口号。端口号是让通信的另一方识别套接字的机制。服务器上做使用的端口号是规定好的。
- 通信阶段：将数据送入套接字发送。
    - $Socket$库的$write$程序将数据发送到套接字中。
    - 接收消息通过$Socket$库的$read$完成。
- 数据传输完毕后，服务器或客户端任意一方将套接字管道断开。
    - $Socket$库的$close$程序组件进入断开阶段。